function _dynamicLoadScript(e){var t=document.createElement("script");t.src=e,t.type="text/javascript",t.async=!1,document.body.appendChild(t),t.addEventListener("load",()=>{console.log("loaded script ",e)}),t.addEventListener("error",e=>{console.log("load script failed ",e)})}let _interpolatingScript=_dynamicLoadScript("./wasm_player/ass.js/interpolating.js"),_assScript=_dynamicLoadScript("./wasm_player/ass.js/ass.js");import{default as backend}from"../wasm_player/player_backend.js";var URL=window.URL||window.webkitURL,VIDEOCTRL_ASPECT_RATIO_EVENT="videoctrl-aspect-ratio";const DEFAULT_CANVAS_SIZE=[640,480];class WPVideoCtrl{constructor(e){this._video=e,this._BE=new backend(e),this._width=640,this._height=480,this._ratio=this._width/this._height,this._duration=0,this._currentTime=0,this._paused=!1,this._played=!1,this._ended=!1,this._src=null,this._muted=!1,this._priorVolume=1,this._playbackRate=1,this._userPlayed=!1,this._userPaused=!1,this._scaleRatio=1,this._isSBS=!1;var s=this;this._on_loadedmetadata=e=>{s._width=e.width,s._height=e.height,s._ratio=s.height/s.width;e=new CustomEvent(VIDEOCTRL_ASPECT_RATIO_EVENT,{detail:{ctrl:s}});s._video.dispatchEvent(e)},this._on_loadedsource=e=>{s._duration=e.duration},this._on_play=e=>{var t=s._BE.getStreams(),e=new CustomEvent("play",{detail:{ctrl:s,info:e,streams:t}});s._video.dispatchEvent(e)},this._on_end=()=>{var e=new CustomEvent("end",{detail:{ctrl:s}});s._video.dispatchEvent(e)},this._BE.onVideoSizeChanged=this._on_loadedmetadata,this._BE.onVideoSourceMetaData=this._on_loadedsource,this._BE.onVideoBegin=this._on_play,this._BE.onVideoEnd=this._on_end,this._resizeObserver=new ResizeObserver(e=>{e=e[0];this._video.width=e.devicePixelContentBoxSize[0].inlineSize,this._video.height=e.devicePixelContentBoxSize[0].blockSize,s._BE.handleCanvasResize()}),this._resizeObserver.observe(this._video)}free(){this._video.removeEventListener(VIDEOCTRL_ASPECT_RATIO_EVENT,this._on_loadedmetadata,{}),this._video=null}get video(){return null}get width(){return this._width}get height(){return this._height}get ratio(){return this._ratio}get paused(){return this._paused}get ended(){return this._ended}get played(){return this._played}get currentTime(){return this._BE.getClock()}get duration(){return this._duration}get src(){return this._src}get muted(){return this._muted}get volume(){return this._BE._volume}get playbackRate(){return this._playbackRate}get userPlayed(){return this._userPlayed}setUserPlayed(){this._userPlayed=!0,this._userPaused=!1}get userPaused(){return this._userPaused}setUserPaused(){this._userPlayed=!1,this._userPaused=!0}addEventListener(e,t,s){this._video.addEventListener(e,t,s)}canPlay(e){return!0}set muted(e){e?(this._priorVolume=this._BE._volume,this._BE.setVolume(0)):this._BE.setVolume(this._priorVolume)}set volume(e){this._BE.setVolume(e)}set playbackRate(e){this._BE.playbackRate=e}playLocalFile(e){return this._BE.setSource(e),this._BE.onPlay(),this.setUserPlayed(),!0}playSource(e,t){throw new Error("WASMPlayer doesn't support play network stream yet!")}pause(){this._BE.onPause(),this.setUserPaused();var e=new CustomEvent("pause",{detail:{ctrl:self}});this._video.dispatchEvent(e)}play(){this._BE.onPlay(),this.setUserPlayed()}restart(){this._BE.onSeek(0),this.setUserPlayed()}seekTo(e){this._BE.onSeek(e)}setExternalSubtitleFiles(e){this._BE.setExternalSubtitleFiles(e)}changeStreams(e,t){this._BE.onChangeStreams(e,t)}setScale(e){this._scaleRatio=e,this._isSBS?this._setSBSMode():this._setNormalMode()}setHPos(e){}setVPos(e){}_setNormalMode(){this._isSBS=!1,this._BE.setNormalMode(this._scaleRatio)}_setSBSMode(){this._isSBS=!0,this._BE.setSBSMode({scaleLevel:this._scaleRatio})}}function _createVideoElement(e,t,s){var i=document.createElement("canvas");return i.id=t,i.className=s,e.appendChild(i),i}function _ensureVideoCtrlCreated(e,t,s,i){let r=e;return e||(e=_createVideoElement(t,(i=i||"")+"video-main",s),r=new WPVideoCtrl(e)),r}function createNormalVideo(e,t,s,i){console.log("createNormalVideo");e=_ensureVideoCtrlCreated(e,t,s,i);return e._setNormalMode(),e}function createSBSVideo(e,t,s,i){e=_ensureVideoCtrlCreated(e,t,s,i);return e._setSBSMode(),e}function videoFilePattern(){return"*.*"}function subtitleFilePattern(){return"*.*"}const STREAM_TYPE_VIDEO=1,STREAM_TYPE_AUDIO=2,STREAM_TYPE_SUBTITLE=3,STREAM_TYPE_EXTERNAL_SUBTITLE=1e3;export{createNormalVideo,createSBSVideo,VIDEOCTRL_ASPECT_RATIO_EVENT,videoFilePattern,subtitleFilePattern,STREAM_TYPE_VIDEO,STREAM_TYPE_AUDIO,STREAM_TYPE_SUBTITLE,STREAM_TYPE_EXTERNAL_SUBTITLE};